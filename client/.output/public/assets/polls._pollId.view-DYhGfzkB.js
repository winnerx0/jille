import{d as S,a as C,b as P,r as v,t as u,j as e}from"./main-C2IzVu6Q.js";import{u as T,U as A}from"./users-C1g7feR7.js";import{u as L,p as j,S as D}from"./api-BflD3T2e.js";import{B as i,a as c}from"./button-BgKzOnNV.js";import{A as E}from"./arrow-left-YhBHTVDr.js";import{T as z,a as _,C as O}from"./trending-up-D9N6ArdP.js";import{A as U,S as V}from"./share-2-DuDBbTX3.js";function $(){const{pollId:r}=S.useParams(),d=C(),m=P(),[N,p]=v.useState(!1),{data:a,isLoading:y,error:h}=T({queryKey:["poll-view",r],queryFn:()=>j.getPollView(r)}),x=L({mutationFn:()=>j.deletePoll(r),onSuccess:()=>{u.success("Poll deleted successfully"),m.invalidateQueries({queryKey:["polls"]}),d({to:"/home"})},onError:t=>{u.error(t.response?.data?.message||"Failed to delete poll")}}),w=(()=>{const t=localStorage.getItem("access_token");if(!t)return null;try{return JSON.parse(atob(t.split(".")[1])).sub}catch{return null}})(),g=a?.creator_id===w;v.useEffect(()=>{if(!g)return;const t="http://localhost:9000",s=new EventSource(`${t}/api/v1/sse`);return s.onmessage=n=>{try{const o=JSON.parse(n.data);o.type==="POLL_VOTE"&&o.payload.poll_id===r&&m.invalidateQueries({queryKey:["poll-view",r]})}catch(o){console.error("Error parsing SSE event:",o)}},()=>{s.close()}},[r,m,g]);const k=()=>{navigator.clipboard.writeText(window.location.origin+`/polls/${r}`),u.success("Voting link copied to clipboard!")};if(y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"w-12 h-12 mb-4 mx-auto text-primary"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Loading live results..."})]})});if(h||!a){const t=h?.response?.status===403;return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"bg-card p-10 text-center max-w-md w-full relative overflow-hidden",children:[e.jsx("h1",{className:"text-3xl font-black mb-3 tracking-tight",children:t?"Creator Access Only":"Poll Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-10 leading-relaxed font-medium",children:t?"This live view is strictly for the poll creator. Please return to the public voting page to participate.":"Oops! The poll you're looking for might have expired, been deleted, or never existed."}),e.jsx("div",{className:"space-y-3",children:e.jsx(i,{size:"lg",className:"w-full rounded-2xl h-12 text-lg font-bold",onClick:()=>d({to:"/home"}),children:"Return to Dashboard"})})]})})}const l=a.options.reduce((t,s)=>t+s.votes.length,0),f=Math.max(...a.options.map(t=>t.votes.length)),b=new Date(a.expires_at).getTime()>Date.now();return e.jsx("div",{className:"min-h-screen bg-background text-foreground py-16 px-4 selection:bg-primary selection:text-primary-foreground",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-12",children:[e.jsxs("button",{onClick:()=>d({to:"/home"}),className:"flex items-center gap-3 text-muted-foreground hover:text-foreground transition-all duration-300 group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border border-border flex items-center justify-center group-hover:border-primary group-hover:bg-primary/5 transition-all",children:e.jsx(E,{className:"w-5 h-5 group-hover:-translate-x-1 transition-transform"})}),e.jsx("span",{className:"font-bold tracking-tight",children:"Dashboard"})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx(i,{variant:"destructive",size:"lg",onClick:()=>p(!0),className:"rounded-2xl px-6 group",children:e.jsx(z,{className:"w-4 h-4 group-hover:animate-bounce"})})})]}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-background/80 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-card p-8 rounded-3xl border border-border shadow-2xl max-w-sm w-full text-center scale-in-center overflow-hidden relative",children:[e.jsx("h2",{className:"text-2xl font-black mb-2",children:"Delete Poll?"}),e.jsx("p",{className:"text-muted-foreground mb-8 text-sm leading-relaxed",children:"This action is permanent and will remove all cast votes. Are you absolutely sure?"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(i,{variant:"destructive",size:"lg",className:"w-full rounded-2xl font-bold h-12",disabled:x.isPending,onClick:()=>x.mutate(),children:x.isPending?"Deleting...":"Yes, Delete Permanently"}),e.jsx(i,{variant:"ghost",size:"lg",className:"w-full rounded-2xl font-bold h-12",onClick:()=>p(!1),children:"Cancel"})]})]})}),e.jsxs("div",{className:"p-8 md:p-16 mb-10 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-12 opacity-[0.03] rotate-12 pointer-events-none",children:e.jsx(_,{className:"w-64 h-64"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-10",children:[e.jsx("div",{className:"bg-primary text-primary-foreground px-5 py-2 rounded-full text-xs font-black uppercase tracking-[0.2em]",children:"Creator Analytics"}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-border text-muted-foreground",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-bold",children:[l.toLocaleString()," Total Votes"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-border text-muted-foreground",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-bold italic",children:"Live Updates Enabled"})]})]}),e.jsx("h1",{className:"text-4xl md:text-6xl font-black mb-16 tracking-tight leading-[1.1]",children:a.title}),e.jsx("div",{className:"grid gap-6",children:a.options.map(t=>{const s=l>0?Math.round(t.votes.length/l*100):0,n=f>0&&t.votes.length===f;return e.jsxs("div",{className:c("w-full text-left relative p-8 rounded-4xl border transition-all duration-500 overflow-hidden",n&&l>0?"bg-primary/3 border-primary/20 shadow-[0_0_40px_rgba(var(--primary-rgb),0.05)]":"bg-muted/10 border-transparent"),children:[e.jsx("div",{className:c("absolute inset-0 opacity-[0.08] transition-all duration-1000 ease-out origin-left",n?"bg-primary":"bg-muted-foreground"),style:{transform:`scaleX(${s/100})`}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl md:text-2xl font-black",children:t.name}),n&&l>0&&e.jsx(U,{className:"w-6 h-6 text-amber-500 animate-in zoom-in duration-500"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-bold text-muted-foreground uppercase tracking-widest",children:[t.votes.length.toLocaleString()," votes"]})})]}),e.jsx("div",{className:"text-right flex flex-col items-end",children:e.jsxs("span",{className:c("text-3xl md:text-5xl font-black tabular-nums transition-colors",n?"text-primary":"text-muted-foreground/50"),children:[s,e.jsx("span",{className:"text-xl md:text-2xl ml-0.5",children:"%"})]})})]})]},t.id)})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 py-10 border-t border-border/50",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-muted-foreground mb-2",children:"Total Outreach"}),e.jsx("p",{className:"text-2xl font-black text-foreground",children:l.toLocaleString()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-muted-foreground mb-2",children:"Poll Status"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:c("w-2 h-2 rounded-full animate-pulse",b?"bg-green-500":"bg-red-500")}),e.jsx("p",{className:"text-sm font-bold uppercase tracking-tighter",children:b?"Actively Collecting":"Voting Concluded"})]})]}),e.jsxs("div",{className:"text-center md:text-right",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-muted-foreground mb-2 flex items-center justify-center md:justify-end gap-2 cursor-pointer",onClick:k,children:[e.jsx(V,{className:"w-3.5 h-3.5"}),"Share Link"]}),e.jsx("p",{className:"text-sm font-bold text-foreground",children:"You (Creator)"})]})]})]})})}export{$ as component};
