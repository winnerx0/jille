import{j as e,b as D,r as I,t as b,L as _,a as O}from"./main-C2IzVu6Q.js";import{U as L,u as q}from"./users-C1g7feR7.js";import{u as T,p as S,S as E}from"./api-BflD3T2e.js";import{u as $,o as A,a as M,b as y,I as w,c as k,s as C,d as V}from"./field-zmsoZvfa.js";import{c as h,B as o}from"./button-BgKzOnNV.js";import{V as R}from"./vote-B8ZLPzx6.js";import{T as Q,a as F,C as U}from"./trending-up-D9N6ArdP.js";const B=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],z=h("arrow-right",B);const H=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],K=h("calendar",H);const Y=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],J=h("log-out",Y);const W=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],j=h("plus",W);const X=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],G=h("triangle-alert",X);const Z=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],P=h("x",Z);function ee({id:l,title:f,options:c,createdAt:d,expires_at:i,creator_id:p}){const m=(()=>{const t=typeof window<"u"?localStorage.getItem("access_token"):null;if(!t)return null;try{return JSON.parse(atob(t.split(".")[1])).sub}catch{return null}})(),r=p===m,x=D(),[N,s]=I.useState(!1),a=T({mutationFn:()=>S.deletePoll(l),onSuccess:()=>{b.success("Poll deleted"),x.invalidateQueries({queryKey:["polls"]})},onError:t=>{b.error(t.response?.data?.message||"Failed to delete poll")}}),n=c.reduce((t,v)=>t+v.votes.length,0),u=i?new Date(i).getTime()<Date.now():!1,g=c.map(t=>({...t,percentage:n>0?Math.round(t.votes.length/n*100):0}));return e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow border border-border hover:shadow-sm hover:border-primary/20 transition-all duration-300 flex flex-col h-full group relative",children:[N&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-background/95 backdrop-blur-sm rounded-2xl flex flex-col items-center justify-center p-6 text-center animate-in fade-in duration-200",children:[e.jsx(G,{className:"w-10 h-10 text-destructive mb-3"}),e.jsx("p",{className:"text-sm font-bold mb-4",children:"Delete this poll permanently?"}),e.jsxs("div",{className:"flex flex-col w-full gap-2",children:[e.jsx(o,{variant:"destructive",size:"sm",className:"w-full rounded-xl h-12",onClick:()=>a.mutate(),disabled:a.isPending,children:a.isPending?"Deleting...":"Confirm Delete"}),e.jsx(o,{variant:"ghost",size:"sm",className:"w-full rounded-xl h-12",onClick:()=>s(!1),children:"Cancel"})]})]}),e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/10 text-primary group-hover:bg-primary group-hover:text-primary-foreground transition-all duration-300",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-card-foreground mb-1 leading-tight line-clamp-2",children:f}),r&&e.jsx("button",{onClick:()=>s(!0),className:"p-1.5 text-muted-foreground hover:text-destructive transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx("span",{className:"bg-destructive/10 text-destructive text-[10px] font-black uppercase tracking-tighter px-1.5 py-0.5 rounded",children:"Ended"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"text-xs font-medium",children:[n," votes cast"]})]})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-8 flex-1",children:[r?g.slice(0,3).map(t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-sm font-semibold text-card-foreground",children:t.name}),e.jsxs("span",{className:"text-xs font-black text-primary/70",children:[t.percentage,"%"]})]}),e.jsx("div",{className:"relative h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary/40 rounded-full transition-all duration-1000",style:{width:`${t.percentage}%`}})})]},t.id)):e.jsx("div",{className:"space-y-2",children:c.slice(0,4).map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted/30 border border-transparent",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary/50"}),e.jsx("span",{className:"text-sm font-medium text-foreground/80 line-clamp-1",children:t.name})]},t.id))}),c.length>(r?3:4)&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center italic",children:["+ ",c.length-(r?3:4)," more options"]})]}),e.jsxs("div",{className:"flex flex-col gap-3 mt-auto",children:[e.jsx(_,{to:"/polls/$pollId",params:{pollId:l},className:"w-full",children:e.jsxs("button",{className:"w-full py-3.5 px-4 bg-muted hover:bg-primary text-muted-foreground hover:text-primary-foreground font-bold rounded-xl transition-all duration-300 flex items-center justify-center gap-2 group/btn",children:[e.jsx("span",{children:r?"Cast Your Vote":"Vote Now"}),e.jsx(z,{className:"w-4 h-4 group-hover/btn:translate-x-1 transition-transform"})]})}),r&&e.jsx(_,{to:"/polls/$pollId/view",params:{pollId:l},className:"w-full",children:e.jsxs("button",{className:"w-full py-3.5 px-4 bg-primary/10 text-primary hover:bg-primary hover:text-primary-foreground font-bold rounded-xl transition-all duration-300 flex items-center justify-center gap-2 group/btn",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Live Results"}),e.jsx(z,{className:"w-4 h-4 group-hover/btn:translate-x-1 transition-transform"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-5 mt-5 border-t border-border/50 text-muted-foreground/70",children:[d&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(U,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:d})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(F,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Live Results"})]})]})]})}function se(){return e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow border border-border animate-pulse h-[400px] flex flex-col",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-11 h-11 bg-muted rounded-xl"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/4"})]})]}),e.jsx("div",{className:"space-y-4 flex-1",children:[1,2,3].map(l=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-1.5 bg-muted rounded-full"})]},l))}),e.jsx("div",{className:"h-12 bg-muted rounded-xl w-full mt-auto"})]})}const te=A({title:C().min(5,"Title must be at least 5 characters"),options:V(C().min(1,"Option cannot be empty")).min(2,"At least 2 options required"),expires_at:C().refine(l=>!isNaN(Date.parse(l)),"Invalid date")});function ce(){const l=O(),f=D(),[c,d]=I.useState(!1),{data:i,isLoading:p,error:m}=q({queryKey:["polls"],queryFn:S.getAllPolls,retry:!1}),r=T({mutationFn:S.createPoll,onSuccess:()=>{b.success("Poll created successfully!"),f.invalidateQueries({queryKey:["polls"]}),d(!1),x.reset()},onError:s=>{b.error(s.response?.data?.message||"Failed to create poll")}}),x=$({defaultValues:{title:"",options:["",""],expires_at:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0]},validators:{onSubmit:te},onSubmit:({value:s})=>{const a=new Date(s.expires_at);a.setHours(23,59,59),r.mutate({...s,expires_at:a.toISOString()})}}),N=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),l({to:"/login"})};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Jille"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Polling Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(o,{size:"lg",className:"rounded-xl flex gap-2",onClick:()=>d(!0),children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("p",{className:"max-md:hidden",children:" Create Poll"})]}),e.jsxs(o,{variant:"outline",size:"lg",onClick:N,className:"rounded-xl flex gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("p",{className:"max-md:hidden",children:"Logout"})]})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-12",children:[e.jsx("div",{className:"mb-8 flex justify-between items-end",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2 text-foreground",children:"Active Polls"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse and participate in ongoing polls"})]})}),m&&e.jsxs("div",{className:"text-center py-12 bg-muted/30 rounded-2xl border border-dashed border-border",children:[e.jsx("div",{className:"inline-flex p-4 rounded-full bg-destructive/10 mb-4",children:e.jsx(P,{className:"w-8 h-8 text-destructive"})}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-foreground",children:"Failed to load polls"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:m instanceof Error?m.message:"An error occurred"})]}),p&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(s=>e.jsx(se,{},s))}),!p&&!m&&i&&i.length>0&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsx(ee,{...s},s.id))}),!p&&!m&&i&&i.length===0&&e.jsxs("div",{className:"text-center py-20 bg-muted/30 rounded-3xl border border-dashed border-border",children:[e.jsx("div",{className:"inline-flex p-6 rounded-full bg-muted mb-6",children:e.jsx(j,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 text-foreground",children:"No polls yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your first poll to get started sharing opinions."}),e.jsxs(o,{size:"lg",className:"rounded-xl",onClick:()=>d(!0),children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Create Your First Poll"]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-background/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-border flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Create New Poll"}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 rounded-lg hover:bg-muted transition-colors",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("form",{className:"p-6 space-y-6",onSubmit:s=>{s.preventDefault(),x.handleSubmit()},children:[e.jsx(x.Field,{name:"title",children:s=>e.jsxs(M,{children:[e.jsx(y,{children:"Poll Title"}),e.jsx(w,{placeholder:"e.g. What's the best fruit?",value:s.state.value,onChange:a=>s.handleChange(a.target.value)}),s.state.meta.errors&&e.jsx(k,{errors:s.state.meta.errors})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:"Options"}),e.jsx(x.Field,{name:"options",children:s=>e.jsxs("div",{className:"space-y-2",children:[s.state.value.map((a,n)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:`Option ${n+1}`,value:s.state.value[n],onChange:u=>{const g=[...s.state.value];g[n]=u.target.value,s.handleChange(g)}}),s.state.value.length>2&&e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const u=[...s.state.value];u.splice(n,1),s.handleChange(u)},children:e.jsx(P,{className:"w-4 h-4"})})]},n)),e.jsxs(o,{type:"button",variant:"ghost",size:"sm",className:"w-full mt-1",onClick:()=>s.handleChange([...s.state.value,""]),children:[e.jsx(j,{className:"w-4 h-4 mr-2"})," Add Option"]}),s.state.meta.errors&&e.jsx(k,{errors:s.state.meta.errors})]})})]}),e.jsx(x.Field,{name:"expires_at",children:s=>e.jsxs(M,{children:[e.jsx(y,{children:"Expiration Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{type:"date",className:"pl-10",min:new Date().toISOString().split("T")[0],value:s.state.value,onChange:a=>s.handleChange(a.target.value)}),e.jsx(K,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"})]}),s.state.meta.errors&&e.jsx(k,{errors:s.state.meta.errors})]})}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx(o,{type:"button",variant:"outline",className:"flex-1 rounded-xl",onClick:()=>d(!1),children:"Cancel"}),e.jsx(o,{type:"submit",className:"flex-1 rounded-xl",disabled:r.isPending,children:r.isPending?e.jsx(E,{}):"Create Poll"})]})]})]})})]})}export{ce as component};
